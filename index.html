<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invio Referti Medici</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 600px; margin: 0 auto; }
        input[type="file"] { display: none; }
        button { padding: 10px 20px; margin: 10px 0; cursor: pointer; }
        .file-list { margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Invio Referti Medici</h1>
        <p>Seleziona i file da inviare al tuo medico</p>
        <input type="file" id="fileInput" multiple>
        <button onclick="createZip()">Crea Archivio ZIP</button>

        <div class="file-list" id="fileList"></div>
        <button id="sendBtn" style="display:none" onclick="sendToTelegram()">Invia su Telegram</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
    <script>
        let selectedFiles = [];

        document.getElementById('fileInput').addEventListener('change', function(event) {
            selectedFiles = Array.from(event.target.files);
            const fileListDiv = document.getElementById('fileList');
            fileListDiv.innerHTML = '';
            selectedFiles.forEach(file => {
                const fileItem = document.createElement('p');
                fileItem.textContent = file.name;
                fileListDiv.appendChild(fileItem);
            });
        });

        function createZip() {
            const zip = new JSZip();
            selectedFiles.forEach(file => {
                zip.file(file.name, file);
            });
            zip.generateAsync({ type: "blob" }).then(function(content) {
                const zipFile = new Blob([content], { type: 'application/zip' });
                const zipUrl = URL.createObjectURL(zipFile);

                // Link per il download
                const downloadLink = document.createElement('a');
                downloadLink.href = zipUrl;
                downloadLink.download = "referti.zip";
                downloadLink.textContent = 'Scarica il file ZIP';

                // Mostra il link per il download e il pulsante di invio
                document.body.appendChild(downloadLink);
                document.getElementById('sendBtn').style.display = 'inline-block';
            });
        }

        function sendToTelegram() {
            const telegramUrl = 'https://t.me/<tuo_medico_username>';
            alert("Copia il link del file ZIP e invialo al tuo medico su Telegram.");
            window.open(telegramUrl, '_blank');
        }
    </script>
</body>
</html>
